<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar IPK Tertinggi</title>
  <link rel="shortcut icon" href="/images/logopolinela.png" type="image/png">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom fixed-top">
  <div class="container">
    <a class="navbar-brand" href="/">
      <img src="/images/logopolinela.png" alt="Logo Polinela">
      <span>SIWILA</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon" style="filter: brightness(0) invert(1);"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item"><a class="nav-link" href="/informasi">Informasi</a></li>
        <li class="nav-item"><a class="nav-link" href="/statistik">Statistik Kelulusan</a></li>
        <li class="nav-item"><a class="nav-link active" href="/daftar-ipk">Daftar IPK</a></li>
        <li class="nav-item"><a class="nav-link" href="/tentang">Tentang</a></li>
      </ul>
      <a href="/auth/login" class="btn-masuk">Masuk</a>
    </div>
  </div>
</nav>

<div style="padding-top: 100px;">
  <section class="section-ipk" id="daftar">
      <div class="container">
      <div class="text-center mb-4">
        <h2 class="section-title">Daftar Mahasiswa Berprestasi</h2>
        <p class="section-subtitle">Data lengkap seluruh wisudawan berdasarkan peringkat IPK</p>
        
        <a href="/ipk-tertinggi-jenjang" class="btn btn-warning fw-bold px-4 py-2 shadow-sm rounded-pill mt-3">
          <i class="fas fa-trophy me-2"></i> Lihat Mahasiswa Terbaik per Jenjang
        </a>
      </div>
      <div class="table-wrapper">
        <div class="search-box-container mb-4">
          <div class="row align-items-center justify-content-center">
            <div class="col-md-8">
              <div class="custom-search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="customSearch" class="custom-search-input" placeholder="Cari berdasarkan nama mahasiswa...">
              </div>
            </div>
          </div>
        </div>

        <div class="table-responsive">
          <table id="ipkTable" class="table table-hover table-custom" style="width:100%">
            <thead>
              <tr>
                <th style="width: 50px;">Rank</th>
                <th>Nama Mahasiswa</th>
                <th>NPM</th>
                <th>Program Studi</th> <th>Jurusan</th>
                <th style="width: 80px;">IPK</th>
                <th style="width: 100px;">Tahun Lulus</th>
              </tr>
            </thead>
            <tbody>
              <% if (typeof topStudents !== 'undefined' && topStudents.length > 0) { %>
                <% topStudents.forEach((student, index) => { %>
                <tr>
                  <td></td> <td class="nama-column"><%= student.nama %></td>
                  <td><%= student.nim %></td>
                  <td><%= student.prodi %></td> <td><%= student.jurusan %></td>
                  <td><span class="ipk-value"><%= student.ipk %></span></td>
                  <td><%= student.tahun_lulus %></td>
                </tr>
                <% }); %>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
  $(document).ready(function() {
    const table = $('#ipkTable').DataTable({
      "language": {
        "zeroRecords": "Tidak ada data yang ditemukan",
        "info": "Menampilkan _START_ sampai _END_ dari _TOTAL_ mahasiswa",
        "paginate": { "previous": "<", "next": ">" }
      },
      "searching": true,
      "paging": true,
      "pageLength": 10,
      "lengthChange": false,
      // Ubah angka 4 menjadi 5, karena ada kolom baru (Prodi) di index 3
      // Index: 0=Rank, 1=Nama, 2=NPM, 3=Prodi, 4=Jurusan, 5=IPK
      "order": [[5, 'desc']], 
      "columnDefs": [
        { 
          "orderable": false, 
          "targets": 0,
          "render": function(data, type, row, meta) {
            return '<span class="rank-badge">#' + (meta.row + 1) + '</span>';
          }
        }
      ]
    });

    // Custom Search
    $('#customSearch').on('keyup', function() {
      table.column(1).search(this.value).draw();
    });

    // Sembunyikan default search box
    $('.dataTables_filter').hide();
  });

  // CSS Tambahan untuk Pagination & Search
  const style = document.createElement('style');
  style.textContent = `
    .dataTables_wrapper .dataTables_paginate { margin-top: 1.5rem; display: flex; justify-content: center; }
    .page-item .page-link { color: #0047AB; border-radius: 5px; margin: 0 2px; }
    .page-item.active .page-link { background-color: #0047AB; color: white; border-color: #0047AB; }
  `;
  document.head.appendChild(style);
</script>

</body>
</html>